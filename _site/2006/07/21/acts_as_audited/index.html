<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>acts_as_audited</title>
  <meta name="description" content="a blog about code">
  <meta name="author" content="Brandon Keepers">
  <meta name="verify-v1" content="UwU5mecrHiDTPVlphLl729aaRCmyz93jrs+ER3RP4Pw=">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="google-site-verification" content="h4QNmQOrsvnIEsMH5GS3s4_jV3ZAZgrEoZdL4RsbOMI" />

  <!--[if lt IE 9]>
    <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->

  <link rel="stylesheet" href="/assets/site-94e1fc1109c1b76ae4fbab0891861760.css">

  <link rel="openid.server" href="http://www.myopenid.com/server">
  <link rel="openid.delegate" href="http://bkeepers.myopenid.com/">
  <link href="http://feeds.feedburner.com/opensoul" rel="alternate" title="opensoul.org" type="application/atom+xml">

  <!-- FIXME:  -->
</head>
<body>
<div class="container">
  <header>
    <h1><a href="/">opensoul.org</a></h1>
  </header>

  <div id="content">
    <article>
  <h1 class="small">acts_as_audited</h1>
  <p class="meta">
    <span class="date">July 21, 2006</span>
    <span class="tags">
      
        acts_as_audited,
      
        plugin,
      
        popular,
      
        rails,
      
        ruby
      
    </span>
  </p>
  <div class="body"><p><ins><strong><span class="caps">NOTE</span>:</strong> This article is out of date. Visit the <a href="http://github.com/collectiveidea/acts_as_audited">project on Github</a> or the <a href="http://groups.google.com/group/acts_as_audited">mailing list</a> for up-to-date information.</ins></p>
<p><code>acts_as_audited</code> is an Active Record plugin that logs all modifications to your models in an <code>audits</code> table. It uses a polymorphic association to store an audit record for any of the model objects that you wish to have audited.  The audit log stores the model that the change was on, the &#8220;action&#8221; (create, update, destroy), a serialzied hash of the changes, and optionally the user that performed the action.</p>
<h3>Auditing in Rails</h3>
<p>If you&#8217;re using acts_as_audited within Rails, you can simply declare which models should be audited.  acts_as_audited can also automatically record the user that made the change if your controller has a <code>current_user</code> method.</p>
<div class="highlight"><pre><code class="ruby"><span class="k">class</span> <span class="nc">ApplicationController</span> <span class="o">&lt;</span> <span class="no">ActionController</span><span class="o">::</span><span class="no">Base</span>
  <span class="n">audit</span> <span class="no">User</span><span class="p">,</span> <span class="no">List</span><span class="p">,</span> <span class="no">Item</span>
<span class="kp">protected</span>
  <span class="k">def</span> <span class="nf">current_user</span>
    <span class="vi">@user</span> <span class="o">||=</span> <span class="no">User</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">session</span><span class="o">[</span><span class="ss">:user</span><span class="o">]</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div><h3>Customizing</h3>
<p>To get auditing outside of Rails, or to customize which fields are audited within Rails, you can explicitly declare <code>acts_as_audited</code> on your models. The <code>:except</code> option allows you to specify one or more attributes that you don&#8217;t want to be saved in the audit log.</p>
<div class="highlight"><pre><code class="ruby"><span class="k">class</span> <span class="nc">User</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
  <span class="n">acts_as_audited</span> <span class="ss">:except</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="ss">:password</span><span class="p">,</span> <span class="ss">:credit_card_number</span><span class="o">]</span>
<span class="k">end</span>
</code></pre></div><h3>Installation</h3>
<p>You can grab the plugin by running:</p>
<pre>
script/plugin install git://github.com/collectiveidea/acts_as_audited.git
</pre>
<p>Run the migration generator and migrate to add the audits table.</p>
<pre>
script/generate audited_migration add_audits_table
rake db:migrate
</pre>
<h3>Upgrading</h3>
<p>Those upgrading from version 0.2 need to add 2 fields the audits table:</p>
<div class="highlight"><pre><code class="ruby"><span class="n">add_column</span> <span class="ss">:audits</span><span class="p">,</span> <span class="ss">:user_type</span><span class="p">,</span> <span class="ss">:string</span>
<span class="n">add_column</span> <span class="ss">:audits</span><span class="p">,</span> <span class="ss">:username</span><span class="p">,</span> <span class="ss">:string</span>
</code></pre></div></div>

  <div id="be-social">
    <a href="https://twitter.com/share" class="twitter-share-button" data-via="bkeepers" data-lang="en" data-related="bkeepers">Tweet</a>
    <a href="https://twitter.com/bkeepers" class="twitter-follow-button" data-show-count="false" data-lang="en">Follow @bkeepers</a>
  </div>
</article>


<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>

  </div>

  <div id="about">
    <section>
      <p>I am <strong>Brandon Keepers</strong>. I build Internet things, usually with Ruby or JavaScript. I work at <a href="http://github.com">GitHub</a> and live in Holland, MI.</p>

      <ul id="links">
        <li>
          <a href="http://twitter.com/bkeepers">
            <span class="icon icon-mark-twitter"></span>
            Follow me on Twitter
          </a>
        </li>
        <li>
          <a href="http://github.com/bkeepers">
            <span class="icon icon-mark-github"></span>
            Follow me on GitHub
          </a>
        </li>
        <li>
          <a href="http://feeds.feedburner.com/opensoul">
            <span class="icon icon-feed"></span>
            Subscribe to the Feed
          </a>
        </li>
      </ul>
    </section>

    <section id="popular">
      <h1>Popular Posts</h1>
      <ul>
      
        <li><a href="/2012/06/05/whats-it-like-to-work-at-github/">What's it like to work at GitHub?</a></li>
      
        <li><a href="/2012/05/23/why-our-code-smells/">Why Our Code Smells</a></li>
      
        <li><a href="/2012/01/12/getting-started-with-sublime-text-2/">Getting Started with Sublime Text 2</a></li>
      
        <li><a href="/2012/01/09/the-40-standup-desk/">The $40 Standup Desk</a></li>
      
        <li><a href="/2011/11/30/haml-the-unforgivable-sin/">HAML: the unforgivable sin</a></li>
      
      </ul>
    </section>

  </div>

  <footer id="copyright">
    Copyright Â© 2006 - 2013 Brandon Keepers
  </footer>
</div>

<!--
FIXME:

<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
try {
var pageTracker = _gat._getTracker("UA-817617-1");
pageTracker._trackPageview();
} catch(err) {}
</script>

<script type="text/javascript">
  (function() {
    var t = document.createElement('script');
    t.type = 'text/javascript'; t.async = true;
    t.id = 'gauges-tracker'; t.setAttribute('data-site-id', '4d5c434255da1271e4000002');
    t.src = 'http://gaug.es/track.js';
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(t, s);
  })();
</script>
-->
</body>
</html>
