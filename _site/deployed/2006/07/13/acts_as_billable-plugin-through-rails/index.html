<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>acts_as_billable :plugin, :through = :rails</title>
  <meta name="description" content="a blog about code">
  <meta name="author" content="Brandon Keepers">
  <meta name="verify-v1" content="UwU5mecrHiDTPVlphLl729aaRCmyz93jrs+ER3RP4Pw=">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="google-site-verification" content="h4QNmQOrsvnIEsMH5GS3s4_jV3ZAZgrEoZdL4RsbOMI" />

  <!--[if lt IE 9]>
    <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->

  <link rel="stylesheet" href="/assets/site-38babed8aca4145f270d32a60b23d16d.css">

  <link rel="openid.server" href="http://www.myopenid.com/server">
  <link rel="openid.delegate" href="http://bkeepers.myopenid.com/">
  <link href="http://feeds.feedburner.com/opensoul" rel="alternate" title="opensoul.org" type="application/atom+xml">

  <!-- FIXME:  -->
</head>
<body>
<div class="container">
  <header>
    <h1><a href="/">opensoul.org</a></h1>
  </header>

  <div id="content">
    <article>
  <h1 class="small">acts_as_billable :plugin, :through = :rails</h1>
  <p class="meta">
    <span class="date">July 13, 2006</span>
    <span class="tags">
      
        plugin,
      
        rails
      
    </span>
  </p>
  <div class="body"><p>At <a href="http://collectiveidea.com">Collective Idea</a>, we&#8217;re developing <a href="http://eventable.com">several</a> <a href="http://7dots.com">apps</a> that take credit card payments. (We&#8217;ve previously <a href="http://blog.7dots.com/articles/2006/05/24/credit-card-hell-merchant-accounts-payment-gateways-and-apis" title="Credit Card Hell: Merchant Accounts, Payment Gateways and APIs">blogged</a> <a href="http://blog.7dots.com/articles/2006/07/01/choosing-a-merchant-provider" title="Chosing a Merchant Provider">about</a> sorting through this whole mine-field of credit card processing.) One of the ideas we came up with early on was using the magic of Ruby and Rails plugins to extract the billing and credit card processing logic into something that is reusable.</p>
<p>We started with <a href="http://home.leetsoft.com/am/">ActiveMerchant</a>, a handy little library developed for <a href="http://shopify.com">Shopify</a> by JadedPixel.  ActiveMerchant is great for abstracting the credit card processing <span class="caps">API</span>, but you still need to figure out what to charge for, how much, how often, and be able to pull up a history of payments.</p>
<p>Welcome to <code>acts_as_billable</code>, a plugin we&#8217;re working on that we think will remove some of the complexity from online billing and payments.  To illustrate how it will work, here is an example.</p>

<pre>
  class User &amp;lt; ActiveRecord::Base
    belongs_to :plan
    acts_as_billable :plan, :frequency =&amp;gt; :monthly
  end

  class Plan &amp;lt; ActiveRecord::Base
    has_many :users
  end
</pre>
<p>When a user signs up for your super-duper-new-app, they can choose a plan. That plan determines what features they get, and how much they pay to use your app.  So, the user should be billed (well charged, but chargable just doesn&#8217;t sound as nice) each month for the plan.</p>
<p>Another example:</p>

<pre>
  class User &amp;lt; ActiveRecord::Base
    has_many :registrations
    acts_as_billable :event, :through =&amp;gt; :registrations
  end

  class Registration &amp;lt; ActiveRecord::Base
    belongs_to :user
    belongs_to :event
  end

  class Event &amp;lt; ActiveRecord::Base
    has_many :registrations
  end
</pre>
<p>A user can register for events, which requires a payment.  Users should then be billed for each event that they register for.</p>
<p>So what does <code>acts_as_billable</code> really do? Several things:</p>
<ol>
    <li>It adds temporary fields for the credit card information and kicks off the processing through ActiveMerchant when a record is saved.  So when an event is created, if the event costs money, it makes the <span class="caps">API</span> calls to process the credit card, returning errors if it fails.</li>
    <li>It adds validations for the credit card information, and validates that the credit card processed successfully.</li>
    <li>It adds polymorphic associations from the billable class (<code>User</code> in this case) to <code>Exchange</code> (transactions) and <code>Invoice</code>. This gives you access to a record of all the user&#8217;s payments.</li>
</ol>
<p>We&#8217;re pretty excited about what this plugin can do so far, and how easy it will make it for us to do more apps that require online payments.  We intend to release this plugin as open source when we get it to a usable state.  I&#8217;m sure there&#8217;s a lot we could do with it that we haven&#8217;t thought of, so we&#8217;d love some feedback.</p></div>

  <div id="be-social">
    <a href="https://twitter.com/share" class="twitter-share-button" data-via="bkeepers" data-lang="en" data-related="bkeepers">Tweet</a>
    <a href="https://twitter.com/bkeepers" class="twitter-follow-button" data-show-count="false" data-lang="en">Follow @bkeepers</a>
  </div>
</article>


<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>

  </div>

  <div id="about">
    <section>
      <p>I am <strong>Brandon Keepers</strong>. I build Internet things, usually with Ruby or JavaScript. I work at <a href="http://github.com">GitHub</a> and live in Holland, MI.</p>

      <p id="links">
        <a href="http://twitter.com/bkeepers" class="icon icon-mark-twitter" title="Follow me on Twitter"></a>
        <a href="http://github.com/bkeepers" class="icon icon-mark-github" title="Follow me on GitHub"></a>
        <a href="http://feeds.feedburner.com/opensoul" class="icon icon-feed" title="Subscribe to the Feed"></a>
      </p>
    </section>

    <section id="popular">
      <h1>Popular Posts</h1>
      <ul>
      
        <li><a href="/2014/04/28/failure/">Lessons learned from a cancelled project</a></li>
      
        <li><a href="/2012/06/05/whats-it-like-to-work-at-github/">What's it like to work at GitHub?</a></li>
      
        <li><a href="/2012/05/23/why-our-code-smells/">Why Our Code Smells</a></li>
      
        <li><a href="/2012/01/09/the-40-standup-desk/">The $40 Standup Desk</a></li>
      
        <li><a href="/2011/11/30/haml-the-unforgivable-sin/">HAML: the unforgivable sin</a></li>
      
      </ul>

      <p><a href="/archives">View All Posts</a></p>
    </section>

  </div>

  <footer id="copyright">
    Copyright Â© 2006 - 2013 Brandon Keepers
  </footer>
</div>

<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
try {
var pageTracker = _gat._getTracker("UA-817617-1");
pageTracker._trackPageview();
} catch(err) {}
</script>

<script type="text/javascript">
  (function() {
    var t = document.createElement('script');
    t.type = 'text/javascript'; t.async = true;
    t.id = 'gauges-tracker'; t.setAttribute('data-site-id', '4d5c434255da1271e4000002');
    t.src = 'http://gaug.es/track.js';
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(t, s);
  })();
</script>
</body>
</html>
