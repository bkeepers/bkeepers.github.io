<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Merging Active Record models</title>
  <meta name="description" content="a blog about code">
  <meta name="author" content="Brandon Keepers">
  <meta name="verify-v1" content="UwU5mecrHiDTPVlphLl729aaRCmyz93jrs+ER3RP4Pw=">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="google-site-verification" content="h4QNmQOrsvnIEsMH5GS3s4_jV3ZAZgrEoZdL4RsbOMI" />

  <!--[if lt IE 9]>
    <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->

  <link rel="stylesheet" href="/assets/site-16738bce59663e55a52bdd751450914c.css">

  <link rel="openid.server" href="http://www.myopenid.com/server">
  <link rel="openid.delegate" href="http://bkeepers.myopenid.com/">
  <link href="http://feeds.feedburner.com/opensoul" rel="alternate" title="opensoul.org" type="application/atom+xml">

  <!-- FIXME:  -->
</head>
<body>
<div class="container">
  <header>
    <h1><a href="/">opensoul.org</a></h1>
  </header>

  <div id="content">
    <article>
  <h1 class="small">Merging Active Record models</h1>
  <p class="meta">
    <span class="date">August 21, 2008</span>
    <span class="tags">
      
        active_record,
      
        data,
      
        merge,
      
        plugin,
      
        rails
      
    </span>
  </p>
  <div class="body"><div class="banner">
<p><!-- Image not found: /assets/2008/8/21/merge.jpg --></p>
</div>
<p>We&#8217;ve been working on a project that involves importing a massive amount of data from multiple sources. The data is somewhat complicated, so we occasionally end up with duplicate records that need merged together. The data is highly normalized, so there are a bunch of associations that also need merged. If you&#8217;ve ever done this by hand, you know how painful it can be.</p>
<p>To alleviate that pain, I introduce you to <a href="http://github.com/collectiveidea/merger">merger</a>, a Rails plugin for merging Active Record models.</p>
<div class="highlight"><pre><code class="ruby"><span class="vi">@person</span><span class="o">.</span><span class="n">merge!</span><span class="p">(</span><span class="no">Person</span><span class="o">.</span><span class="n">find_all_by_email</span><span class="p">(</span><span class="vi">@person</span><span class="o">.</span><span class="n">email</span><span class="p">))</span>
</code></pre></div><p>The plugin is pretty simple right now. All it does is:</p>
<ol>
	<li>Given a set of records, picks the oldest record (the one with the lowest id) as the one to keep</li>
	<li>Moves any associated <code>has_many</code> and <code>habtm</code> records from the duplicates to the record that is being kept</li>
	<li>Deletes the duplicate records</li>
</ol>
<p>We intend to add a lot to it, including:</p>
<ul>
	<li>Strategies for choosing which record to keep</li>
	<li>Strategies for merging the individual attributes of the records</li>
	<li>Recursively merge associations based on certain attributes</li>
	<li>Options for what to do with the duplicate records</li>
</ul>
<p><a href="http://github.com/collectiveidea/merger">Check it out on Github</a> and let us know what you think.</p>
<ol class="footnotes">
  <li>Photo adapted from <a href="http://flickr.com/photos/xrrr/2478140383/">http://flickr.com/photos/xrrr/2478140383/</a></li>
</ol></div>

  <div id="be-social">
    <a href="https://twitter.com/share" class="twitter-share-button" data-via="bkeepers" data-lang="en" data-related="bkeepers">Tweet</a>
    <a href="https://twitter.com/bkeepers" class="twitter-follow-button" data-show-count="false" data-lang="en">Follow @bkeepers</a>
  </div>
</article>


<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>

  </div>

  <div id="about">
    <section>
      <p>I am <strong>Brandon Keepers</strong>. I build Internet things, usually with Ruby or JavaScript. I work at <a href="http://github.com">GitHub</a> and live in Holland, MI.</p>

      <p id="links">
        <a href="http://twitter.com/bkeepers" class="icon icon-mark-twitter" title="Follow me on Twitter"></a>
        <a href="http://github.com/bkeepers" class="icon icon-mark-github" title="Follow me on GitHub"></a>
        <a href="http://feeds.feedburner.com/opensoul" class="icon icon-feed" title="Subscribe to the Feed"></a>
      </p>
    </section>

    <section id="popular">
      <h1>Popular Posts</h1>
      <ul>
      
        <li><a href="/2014/04/28/failure/">Lessons learned from a cancelled project</a></li>
      
        <li><a href="/2012/06/05/whats-it-like-to-work-at-github/">What's it like to work at GitHub?</a></li>
      
        <li><a href="/2012/05/23/why-our-code-smells/">Why Our Code Smells</a></li>
      
        <li><a href="/2012/01/09/the-40-standup-desk/">The $40 Standup Desk</a></li>
      
        <li><a href="/2011/11/30/haml-the-unforgivable-sin/">HAML: the unforgivable sin</a></li>
      
      </ul>

      <p><a href="/archives">View All Posts</a></p>
    </section>

  </div>

  <footer id="copyright">
    Copyright Â© 2006  - 2014 Brandon Keepers
  </footer>
</div>

<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
try {
var pageTracker = _gat._getTracker("UA-817617-1");
pageTracker._trackPageview();
} catch(err) {}
</script>

<script type="text/javascript">
  (function() {
    var t = document.createElement('script');
    t.type = 'text/javascript'; t.async = true;
    t.id = 'gauges-tracker'; t.setAttribute('data-site-id', '4d5c434255da1271e4000002');
    t.src = 'http://gaug.es/track.js';
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(t, s);
  })();
</script>
</body>
</html>
