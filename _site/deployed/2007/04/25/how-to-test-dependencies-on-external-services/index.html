<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>How to test dependencies on external services?</title>
  <meta name="description" content="a blog about code">
  <meta name="author" content="Brandon Keepers">
  <meta name="verify-v1" content="UwU5mecrHiDTPVlphLl729aaRCmyz93jrs+ER3RP4Pw=">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="google-site-verification" content="h4QNmQOrsvnIEsMH5GS3s4_jV3ZAZgrEoZdL4RsbOMI" />

  <!--[if lt IE 9]>
    <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->

  <link rel="stylesheet" href="/assets/site-38babed8aca4145f270d32a60b23d16d.css">

  <link rel="openid.server" href="http://www.myopenid.com/server">
  <link rel="openid.delegate" href="http://bkeepers.myopenid.com/">
  <link href="http://feeds.feedburner.com/opensoul" rel="alternate" title="opensoul.org" type="application/atom+xml">

  <!-- FIXME:  -->
</head>
<body>
<div class="container">
  <header>
    <h1><a href="/">opensoul.org</a></h1>
  </header>

  <div id="content">
    <article>
  <h1 class="small">How to test dependencies on external services?</h1>
  <p class="meta">
    <span class="date">April 25, 2007</span>
    <span class="tags">
      
        ruby,
      
        testing
      
    </span>
  </p>
  <div class="body"><p>I&#8217;ve been writing a lot of code lately that depends on external services, and I&#8217;ve really been struggling with how to test it well.</p>
<h3>Tinder</h3>
<p>The tests for <a href="http://tinder.rubyforge.org">Tinder</a>, the unofficial <a href="http://campfirenow.com">Campfire</a> &#8220;<span class="caps">API</span>&#8221;, are pathetic. Partially because it was originally just a proof of concept and partially because I just didn&#8217;t have a clue about how to write tests that would actually tests and not just execute the code.</p>
<p>The problem with Tinder is that it is really hard to isolate the tests.  By default, every test will have 2 points of failure, the code to set up the test and the code to verify the result.</p>
<p>For example, here would be the test for deleting a room:</p>
<div class="highlight"><pre><code class="ruby"><span class="n">c</span> <span class="o">=</span> <span class="no">Tinder</span><span class="o">::</span><span class="no">Campfire</span><span class="o">.</span><span class="n">new</span> <span class="s1">&#39;mycampfire&#39;</span>
<span class="n">c</span><span class="o">.</span><span class="n">login</span><span class="p">(</span><span class="s1">&#39;email&#39;</span><span class="p">,</span> <span class="s1">&#39;pass&#39;</span><span class="p">)</span>
<span class="n">room</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">create_room</span> <span class="s1">&#39;My Test Room&#39;</span>
<span class="n">assert</span> <span class="n">room</span><span class="o">.</span><span class="n">destroy</span>
<span class="n">assert</span> <span class="o">!</span><span class="n">c</span><span class="o">.</span><span class="n">find_room_by_name</span><span class="p">(</span><span class="s1">&#39;My Test Room&#39;</span><span class="p">)</span>
</code></pre></div><p>How do I know that it is working?  All I&#8217;m testing is that <code>#destroy</code> returns true and that Tinder thinks that it is gone.  Is that good enough?  To make matters worse, every other test will depend on at least login with whatever other setup code is required.</p>
<p>Ideally, each <span class="caps">API</span> method would be tested by making assertions on the <span class="caps">HTTP</span> request/response.</p>
<h3>Graticule</h3>
<p>With <a href="http://graticule.rubyforge.org">Graticule</a>, I decided that instead of requiring <span class="caps">API</span> keys for every service and hitting up against them with every test (especially since some services are pay-per-request), I would just save sample responses and mock the <span class="caps">HTTP</span> connection.  This works really well as far as unit testing goes, but poses problems if services change their APIs.</p>
<p>Ideally, what I need is to be able to run the exact same test suite locally and remotely, but I haven&#8217;t figured out a good way to do the setup.</p>
<h3>What is a wanna-be tester to do?</h3>
<p>I could keep talking about examples (<span class="caps">LDAP</span>, <a href="http://rubyforge.org/projects/caldav">CalDAV</a>, etc.), but you get the point.</p>
<p>Testing <strong>isn&#8217;t supposed</strong> to worry about the internals of the code and only test the <span class="caps">API</span>, but with something like Tinder, how do you properly test it without peeking into the guts? What are some things you are doing to handle external dependencies?</p></div>

  <div id="be-social">
    <a href="https://twitter.com/share" class="twitter-share-button" data-via="bkeepers" data-lang="en" data-related="bkeepers">Tweet</a>
    <a href="https://twitter.com/bkeepers" class="twitter-follow-button" data-show-count="false" data-lang="en">Follow @bkeepers</a>
  </div>
</article>


<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>

  </div>

  <div id="about">
    <section>
      <p>I am <strong>Brandon Keepers</strong>. I build Internet things, usually with Ruby or JavaScript. I work at <a href="http://github.com">GitHub</a> and live in Holland, MI.</p>

      <p id="links">
        <a href="http://twitter.com/bkeepers" class="icon icon-mark-twitter" title="Follow me on Twitter"></a>
        <a href="http://github.com/bkeepers" class="icon icon-mark-github" title="Follow me on GitHub"></a>
        <a href="http://feeds.feedburner.com/opensoul" class="icon icon-feed" title="Subscribe to the Feed"></a>
      </p>
    </section>

    <section id="popular">
      <h1>Popular Posts</h1>
      <ul>
      
        <li><a href="/2012/06/05/whats-it-like-to-work-at-github/">What's it like to work at GitHub?</a></li>
      
        <li><a href="/2012/05/23/why-our-code-smells/">Why Our Code Smells</a></li>
      
        <li><a href="/2012/01/12/getting-started-with-sublime-text-2/">Getting Started with Sublime Text 2</a></li>
      
        <li><a href="/2012/01/09/the-40-standup-desk/">The $40 Standup Desk</a></li>
      
        <li><a href="/2011/11/30/haml-the-unforgivable-sin/">HAML: the unforgivable sin</a></li>
      
      </ul>
    </section>

  </div>

  <footer id="copyright">
    Copyright Â© 2006 - 2013 Brandon Keepers
  </footer>
</div>

<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
try {
var pageTracker = _gat._getTracker("UA-817617-1");
pageTracker._trackPageview();
} catch(err) {}
</script>

<script type="text/javascript">
  (function() {
    var t = document.createElement('script');
    t.type = 'text/javascript'; t.async = true;
    t.id = 'gauges-tracker'; t.setAttribute('data-site-id', '4d5c434255da1271e4000002');
    t.src = 'http://gaug.es/track.js';
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(t, s);
  })();
</script>
</body>
</html>
